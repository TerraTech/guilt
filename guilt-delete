#!/bin/bash
#
# Copyright (c) Josef "Jeff" Sipek, 2006, 2007
#

source "`dirname $0`/guilt"

USAGE="$USAGE [-f] <patchname>"

case $# in
	1)
		# just patchname
		force=
		;;
	2)
		# -f patchname
		if [ "$1" != "-f" ]; then
			print_usage
			exit 2
		fi

		force=t
		shift
		;;
	*)
		print_usage
		exit 1
		;;
esac

patch="$1"

if [ -z "$patch" ]; then
	print_usage
	echo "You must specify a patch to delete"
	exit 1
fi

p=`grep -e "^[0-9a-f]\{40\}:$patch\$" < "$applied"`
if [ ! -z "$p" ] ; then
	echo "Cannot delete an applied patch"
	exit 1
fi

grep -v "^$patch\$" < "$series" > "$series.tmp"
mv "$series.tmp" "$series"

[ ! -z "$force" ] && rm -f $GUILT_DIR/$branch/$patch

exit 0
