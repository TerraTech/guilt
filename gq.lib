#!/bin/bash

function find_git_dir_nice
{
	# let the user override
	if [ ! -z "$GIT_DIR" ]; then
		[ -d "$GIT_DIR" ] && echo "$GIT_DIR" || echo "Bogus GIT_DIR" >&2
		return
	fi

	DIR=`pwd`
	while true; do
		if [ -d "$DIR/.git" ]; then
			echo "$DIR/.git"
			return
		fi

		DIR2=`dirname $DIR`
		[ "$DIR" = "$DIR2" ] && break
		DIR="$DIR2"
	done

	return
}

function find_git_dir
{
	d=`find_git_dir_nice`

	if [ -z "$d" ]; then
		echo "Cannot find .git"
		exit 1
	fi

	echo "$d"
}

function get_branch
{
	git branch | awk 'BEGIN{}/*/{print $2}END{}'
}

function get_branch_verify
{
	b=`get_branch`
	if [ ! -d "$GIT_DIR/patches/$branch" ]; then
		echo "Branch $branch is not initialized, try gq-init"
		exit 1
	fi

	echo "$b"
}

